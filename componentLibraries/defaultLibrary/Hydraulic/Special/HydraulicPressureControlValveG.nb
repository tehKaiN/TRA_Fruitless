(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     15815,        391]
NotebookOptionsPosition[     14815,        357]
NotebookOutlinePosition[     15159,        372]
CellTagsIndexPosition[     15116,        369]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["PressureControlValveG", "Section",
 CellChangeTimes->{{3.4785828348125*^9, 3.47858284740625*^9}, 
   3.47867904165625*^9, {3.483026885*^9, 3.483026890359375*^9}, 
   3.4988885288318987`*^9, {3.507886987593746*^9, 3.507887015359016*^9}, 
   3.507887177638189*^9, {3.572724409593012*^9, 3.572724410652072*^9}, {
   3.5731444722970257`*^9, 3.5731444763132553`*^9}, {3.573144509032127*^9, 
   3.5731445114602656`*^9}, {3.5731516615712285`*^9, 3.573151663333329*^9}}],

Cell[CellGroupData[{

Cell["System model", "Subsection",
 CellChangeTimes->{{3.504161099890625*^9, 3.504161102453125*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"domain", "=", "\"\<Hydraulic\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"displayName", "=", "\"\<PressureControlValveG\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
  "brief", "=", 
   "\"\<A hydraulic pressure relief valve based on geometry\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"componentType", "=", "\"\<ComponentQ\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"author", "=", "\"\<Petter Krus <petter.krus@liu.se>\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "affiliation", " ", "=", " ", 
   "\"\<Division of Fluid and Mechatronic Systems, Link\[ODoubleDot]ping \
University\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetFilenames", "[", 
   RowBox[{"path", ",", "domain", ",", "displayName"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ResetComponentVariables", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.503905077842648*^9, 3.503905079842648*^9}, {
   3.5039103076641607`*^9, 3.5039103985397425`*^9}, {3.5039164662834997`*^9, 
   3.5039164750178747`*^9}, {3.5039165143772497`*^9, 
   3.5039165189397497`*^9}, {3.5041051675625*^9, 3.504105226359375*^9}, {
   3.507570546125*^9, 3.507570569546875*^9}, {3.507570601046875*^9, 
   3.50757067696875*^9}, 3.507796401609375*^9, {3.507887022343302*^9, 
   3.507887057967846*^9}, {3.5078871702320337`*^9, 3.507887175028847*^9}, {
   3.5158208831437864`*^9, 3.51582092036206*^9}, 3.52267078596875*^9, {
   3.5727244220517244`*^9, 3.5727244258479414`*^9}, {3.5731445197087374`*^9, 
   3.5731445222458825`*^9}, {3.5731519828286037`*^9, 3.573151986646822*^9}, 
   3.5758601223526926`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"nodeConnections", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"HydraulicQnode", "[", 
      RowBox[{"1", ",", 
       RowBox[{"1.", "*", 
        RowBox[{"10", "^", "5"}]}], ",", "\"\<Upstream port\>\""}], "]"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"HydraulicQnode", "[", 
      RowBox[{"2", ",", 
       RowBox[{"1.", "*", 
        RowBox[{"10", "^", "5"}]}], ",", "\"\<Downstream port\>\""}], "]"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"HydraulicQnode", "[", 
      RowBox[{"3", ",", 
       RowBox[{"1.", "*", 
        RowBox[{"10", "^", "5"}]}], ",", "\"\<Opening port\>\""}], "]"}], ",",
      "\[IndentingNewLine]", 
     RowBox[{"HydraulicQnode", "[", 
      RowBox[{"4", ",", 
       RowBox[{"1.", "*", 
        RowBox[{"10", "^", "5"}]}], ",", "\"\<Closing port\>\""}], "]"}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.4752292939381866`*^9, 3.4752293318441935`*^9}, {
   3.47808399728125*^9, 3.478083998921875*^9}, 3.4988885288475237`*^9, {
   3.50394176215625*^9, 3.503941811890625*^9}, {3.507576389140625*^9, 
   3.507576508765625*^9}, {3.50757655321875*^9, 3.507576570375*^9}, {
   3.507796238859375*^9, 3.50779624034375*^9}, {3.5156830475625*^9, 
   3.515683050984375*^9}, {3.538136856098759*^9, 3.5381369597752786`*^9}, {
   3.5719055396181374`*^9, 3.5719055424261427`*^9}, {3.5731449671873317`*^9, 
   3.5731449722026186`*^9}, {3.5731516922089806`*^9, 3.573151698003312*^9}, {
   3.577606187835734*^9, 3.5776061941131063`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"inputVariables", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{"pref", ",", 
      RowBox[{"1.", "*", 
       RowBox[{"10", "^", "6"}]}], ",", "double", ",", "\"\<Pa\>\"", ",", 
      "\"\<Reference pressure\>\""}], "}"}], "\[IndentingNewLine]", "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.5381369657755475`*^9, 3.5381370104181724`*^9}, 
   3.5731449806651025`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"outputVariables", "=", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "xv", ",", "0.", ",", "double", ",", "\"\<m\>\"", ",", 
       "\"\<Spool position\>\""}], "}"}], "\[IndentingNewLine]", "}"}]}], 
   ";"}], " "}]], "Input",
 CellChangeTimes->{{3.5381369720414534`*^9, 3.5381369916673326`*^9}, 
   3.5777295233351817`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"inputParameters", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "rho", ",", "860.", ",", "double", ",", "\"\<kg/m3\>\"", ",", 
       "\"\<oil density\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "visc", ",", "0.03", ",", "double", ",", "\"\<Ns/m2\>\"", ",", 
       "\"\<viscosity \>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "Dv", ",", "0.01", ",", "double", ",", "\"\<m\>\"", ",", 
       "\"\<Spool diameter\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "frac", ",", "0.1", ",", "double", ",", "\"\<\>\"", ",", 
       "\"\<Fraction of spool opening\>\""}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "Bv", ",", "1000.", ",", "double", ",", "\"\<N/(m s)\>\"", ",", 
       "\"\<Damping\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "Xvmax", ",", "0.002", ",", "double", ",", "\"\<m\>\"", ",", 
       "\"\<Max spool displacement\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "Cq", ",", "0.67", ",", "double", ",", "\"\< \>\"", ",", 
       "\"\<Flow coefficient\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "phi", ",", "1.17", ",", "double", ",", "\"\<rad\>\"", ",", 
       "\"\<Stream angle\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "ks", ",", "10000.", ",", "double", ",", "\"\<N/m\>\"", ",", 
       "\"\<Spring constant\>\""}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "p0", ",", "100000.", ",", "double", ",", "\"\<Pa\>\"", ",", 
       "\"\<Turbulent pressure trans.\>\""}], "}"}]}], "\[IndentingNewLine]", 
    "}"}]}], ";"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.4779981058619356`*^9, 3.4779981542683554`*^9}, 
   3.4780017782035847`*^9, {3.478002203430644*^9, 3.478002217153696*^9}, {
   3.478002277203772*^9, 3.4780023021490927`*^9}, {3.4780026209521627`*^9, 
   3.478002664340765*^9}, {3.478021796078125*^9, 3.478021842203125*^9}, {
   3.478021885296875*^9, 3.47802199571875*^9}, {3.47802539628125*^9, 
   3.478025479125*^9}, {3.478026054375*^9, 3.47802606034375*^9}, {
   3.47818056640625*^9, 3.47818064359375*^9}, {3.478184752578125*^9, 
   3.478184788859375*^9}, {3.4781848254375*^9, 3.47818487890625*^9}, {
   3.47818496809375*^9, 3.478184980140625*^9}, {3.478189354859375*^9, 
   3.478189379078125*^9}, {3.478679541453125*^9, 3.478679542*^9}, 
   3.47868324640625*^9, 3.478683514703125*^9, {3.4807602098503075`*^9, 
   3.480760210147073*^9}, {3.480760285603793*^9, 3.4807602892909627`*^9}, 
   3.480760331584048*^9, 3.483026964640625*^9, {3.483027180765625*^9, 
   3.483027244046875*^9}, {3.4873878032782784`*^9, 3.4873878199976707`*^9}, 
   3.4988223817958884`*^9, 3.4988885288318987`*^9, {3.5023520516875*^9, 
   3.50235222190625*^9}, {3.50235391759375*^9, 3.50235391940625*^9}, 
   3.503905029342648*^9, 3.5039111089927917`*^9, {3.503914664843855*^9, 
   3.503914668218855*^9}, {3.50391516520323*^9, 3.503915204718855*^9}, {
   3.5039967133130913`*^9, 3.5039967163764143`*^9}, {3.5039969681607733`*^9, 
   3.503996993616342*^9}, {3.507574582234375*^9, 3.507574588828125*^9}, {
   3.507576286109375*^9, 3.507576354453125*^9}, {3.5077959019375*^9, 
   3.507795944828125*^9}, {3.51568580440625*^9, 3.51568581115625*^9}, 
   3.5159285657593565`*^9, {3.573147641136273*^9, 3.5731476559331193`*^9}, {
   3.5731482493080587`*^9, 3.5731482508341455`*^9}, {3.6180818304459014`*^9, 
   3.6180818626187415`*^9}, {3.618082164371001*^9, 3.6180821690472684`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"kf", "=."}], ";", 
  RowBox[{"ke", "=."}], ";"}]], "Input",
 CellChangeTimes->{{3.577616272848119*^9, 3.5776162781606503`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"localExpressions", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Av", "==", 
      FractionBox[
       RowBox[{"pi", " ", 
        SuperscriptBox["Dv", "2"]}], "4"]}], ",", "\[IndentingNewLine]", 
     RowBox[{"w", "==", 
      RowBox[{"pi", " ", "frac", " ", "Dv", " ", 
       RowBox[{"Sin", "[", "phi", "]"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"p3", "\[Equal]", "c3"}], ",", "\[IndentingNewLine]", 
     RowBox[{"p4", "\[Equal]", "c4"}]}], "\[IndentingNewLine]", "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.483027001578125*^9, 3.483027021109375*^9}, {
   3.4873877137123394`*^9, 3.487387727322237*^9}, 3.4988885288318987`*^9, {
   3.503914893406355*^9, 3.50391490070323*^9}, {3.50391509367198*^9, 
   3.503915095406355*^9}, {3.525772523916875*^9, 3.525772528510625*^9}, {
   3.534756520505298*^9, 3.534756559181628*^9}, {3.534756692025055*^9, 
   3.534756695744233*^9}, {3.57190456751803*^9, 3.571904619278921*^9}, {
   3.573144677962789*^9, 3.5731446825110493`*^9}, {3.5731482912764587`*^9, 
   3.573148292495528*^9}, 3.5731497546971617`*^9, {3.577606212840233*^9, 
   3.5776062364068766`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"kf", "=", 
   RowBox[{"2", " ", "Cq", " ", "w", " ", 
    RowBox[{"Cos", "[", "phi", "]"}], " ", 
    RowBox[{"(", 
     RowBox[{"p1", "-", "p2"}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ke", "=", 
   RowBox[{"ks", "+", "kf"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.573149759175418*^9, 3.573149768059926*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"systemEquationsDA", "=", " ", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Bv", " ", 
        RowBox[{"der", "[", " ", "xv", "]"}]}], " ", "+", 
       RowBox[{"ke", " ", "xv"}]}], " ", "==", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"p3", "-", "p4", "-", "pref"}], ")"}], "Av"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"q2", "==", 
      RowBox[{"xv", "*", "Cq", " ", "w", " ", 
       SqrtBox[
        FractionBox["2.", "rho"]], 
       RowBox[{"signedSquareL", "[", 
        RowBox[{
         RowBox[{"p1", "-", "p2"}], ",", "p0"}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.478679350421875*^9, 3.4786793594375*^9}, {
   3.47867939090625*^9, 3.478679416*^9}, 3.483026918*^9, 
   3.4873877224157987`*^9, 3.4988885288318987`*^9, {3.5039967325838947`*^9, 
   3.5039967690624475`*^9}, {3.504104403484375*^9, 3.50410440521875*^9}, {
   3.5075701360625*^9, 3.507570153265625*^9}, {3.507570213453125*^9, 
   3.507570214015625*^9}, {3.5075703420625*^9, 3.507570342109375*^9}, 
   3.5076079715712585`*^9, {3.507796204234375*^9, 3.50779621396875*^9}, {
   3.507887076139488*^9, 3.5078870785613317`*^9}, {3.5719046338649464`*^9, 
   3.571904651898578*^9}, 3.571904682880233*^9, {3.572724506299543*^9, 
   3.5727245105057836`*^9}, {3.5731445594490104`*^9, 3.573144562194167*^9}, 
   3.5731447183681*^9, 3.5731517185544877`*^9, {3.57776577761719*^9, 
   3.57776579038319*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"systemBoundaryEquations", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"p1", "==", 
      RowBox[{"c1", "-", 
       RowBox[{"Zc1e", " ", "q2"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"p2", "==", 
      RowBox[{"c2", "+", 
       RowBox[{"Zc2e", " ", "q2"}]}]}]}], "\[IndentingNewLine]", "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.478679428921875*^9, 3.478679481265625*^9}, 
   3.4873877346662693`*^9, 3.4988885288318987`*^9, {3.5158210639861856`*^9, 
   3.51582106472056*^9}, {3.515900478739354*^9, 3.5159004792862253`*^9}, {
   3.515928580869215*^9, 3.515928582853654*^9}, 3.52577253333875*^9, {
   3.5719211535301576`*^9, 3.5719211557453613`*^9}, {3.573144594916039*^9, 
   3.57314462640184*^9}, 3.5731446879953628`*^9, {3.5731447690099964`*^9, 
   3.573144801970882*^9}, {3.5731515430534496`*^9, 3.57315154462954*^9}, {
   3.5785094683648205`*^9, 3.578509470091919*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"systemVariables", "=", 
   RowBox[{"{", 
    RowBox[{"xv", ",", "q2", ",", "p1", ",", "p2"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{
  3.504160940796875*^9, {3.504171522859375*^9, 3.504171524921875*^9}, {
   3.507570128828125*^9, 3.507570132078125*^9}, 3.50757021896875*^9, 
   3.507796195640625*^9, 3.507887067686471*^9, 3.571904675095819*^9, {
   3.5731446574486156`*^9, 3.5731446730035057`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"expressions", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"q1", "\[Equal]", 
      RowBox[{"-", "q2"}]}], ",", 
     RowBox[{"q3", "\[Equal]", "0."}], ",", 
     RowBox[{"q4", "\[Equal]", "0."}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.571904437694602*^9, 3.5719044499406233`*^9}, {
  3.573144637230459*^9, 3.5731446529073563`*^9}, {3.5731450037174215`*^9, 
  3.5731450263717165`*^9}, {3.5731516830154552`*^9, 3.5731516861856365`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"variableLimits", "=", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"xv", ",", "0.", ",", "Xvmax"}], "}"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{3.5078869449067926`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"variableLowLimits", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"p2", ",", "0"}], "}"}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.578505814681842*^9, 3.5785058445435495`*^9}, 
   3.578509359037567*^9}],

Cell[BoxData[
 RowBox[{"Compgen", "[", "file", "]"}]], "Input",
 CellChangeTimes->{3.5039025691670113`*^9}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{707, 505},
WindowMargins->{{Automatic, -5}, {-49, Automatic}},
FrontEndVersion->"8.0 for Microsoft Windows (64-bit) (October 6, 2011)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 468, 6, 71, "Section"],
Cell[CellGroupData[{
Cell[1072, 32, 100, 1, 36, "Subsection"],
Cell[1175, 35, 1632, 36, 172, "Input"],
Cell[2810, 73, 1565, 33, 132, "Input"],
Cell[4378, 108, 438, 11, 72, "Input"],
Cell[4819, 121, 407, 11, 72, "Input"],
Cell[5229, 134, 3757, 72, 252, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[8989, 208, 162, 4, 31, "Input"],
Cell[9154, 214, 1179, 23, 164, "Input"],
Cell[10336, 239, 373, 10, 52, "Input"],
Cell[10712, 251, 1524, 33, 130, "Input"],
Cell[12239, 286, 952, 19, 92, "Input"],
Cell[13194, 307, 440, 9, 31, "Input"],
Cell[13637, 318, 485, 11, 31, "Input"],
Cell[14125, 331, 215, 6, 31, "Input"],
Cell[14343, 339, 334, 10, 31, "Input"],
Cell[14680, 351, 107, 2, 31, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
